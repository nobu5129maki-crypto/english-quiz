<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±å˜èªãƒã‚¹ã‚¿ãƒ¼ Pro (é«˜é€Ÿèµ·å‹•ç‰ˆ)</title>
    <style>
        :root { --primary: #4CAF50; --bg: #eef2f3; --review: #f39c12; --listen: #9b59b6; --time: #e74c3c; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .card { background: white; padding: 2rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; position: relative; z-index: 20; }
        .header-controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 1rem; }
        .top-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .mode-selector { display: flex; background: #ddd; border-radius: 12px; padding: 4px; gap: 4px; flex-grow: 1; }
        .mode-option { flex: 1; padding: 8px 5px; font-size: 0.8rem; border-radius: 8px; cursor: pointer; font-weight: bold; color: #666; transition: 0.3s; }
        .mode-option.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #time-tri-btn { font-size: 1.4rem; padding: 2px 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        #time-tri-btn.active { color: var(--time); background: #ffdada; animation: pulse 1.5s infinite; border-radius: 8px; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .timer-display { font-size: 1.4rem; font-weight: bold; color: var(--time); visibility: hidden; min-width: 70px; }
        .highscore-display { font-size: 0.85rem; color: #7f8c8d; margin-top: 5px; background: #f9f9f9; padding: 4px; border-radius: 8px; }
        .word-display { font-size: 2.5rem; font-weight: bold; margin-bottom: 1rem; color: #2c3e50; min-height: 3.5rem; display: flex; justify-content: center; align-items: center; }
        .options-grid { display: grid; gap: 10px; }
        .option-btn { padding: 16px; border: 2px solid #ddd; border-radius: 12px; background: white; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .option-btn.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        .option-btn.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        #spell-input-area { display: none; }
        #spell-input { width: 85%; padding: 14px; font-size: 1.4rem; border: 2px solid #ddd; border-radius: 12px; text-align: center; }
        .speaker-btn { background: #f0f0f0; border: 2px solid #ddd; border-radius: 50%; width: 60px; height: 60px; cursor: pointer; font-size: 1.8rem; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; }
        .btn-main { padding: 15px 25px; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 12px; width: 100%; margin-top: 20px; font-size: 1.2rem; font-weight: bold; }
        #feedback { margin-top: 10px; font-weight: bold; min-height: 24px; font-size: 1rem; }
    </style>
</head>
<body>

<div class="card" id="game-card">
    <div id="game-content">
        <div class="header-controls">
            <div class="top-row">
                <div class="mode-selector">
                    <div class="mode-option active" onclick="changeMode('choice')">4æŠ</div>
                    <div class="mode-option" onclick="changeMode('spell')">æ›¸ã</div>
                    <div class="mode-option" onclick="changeMode('listen')">èã</div>
                    <div class="mode-option" id="time-tri-btn" onclick="toggleTimeTrial()">â±</div>
                </div>
                <div id="timer" class="timer-display">10:00</div>
            </div>
            <div class="highscore-display">æœ€é«˜è¨˜éŒ²: <span id="high-score">0</span></div>
        </div>
        <div class="score-board" style="color:#7f8c8d; margin-bottom:5px; font-size: 1rem; font-weight: bold;">
            ã‚¹ã‚³ã‚¢: <span id="score" style="color:var(--primary);">0</span>
        </div>
        <div class="word-display"><span id="target-display">Start!</span></div>
        <button id="speaker-icon" class="speaker-btn" onclick="retrySpeak()">ğŸ”Š</button>
        <div class="options-grid" id="options"></div>
        <div id="spell-input-area"><input type="text" id="spell-input" placeholder="å…¥åŠ›..." autocomplete="off"></div>
        <div id="feedback"></div>
    </div>
</div>

<script>
    const masterWordList = [
                             { en: "Hello", ja: "ã“ã‚“ã«ã¡ã¯" },
        { en: "Thank you", ja: "ã‚ã‚ŠãŒã¨ã†" },
        { en: "Excuse me", ja: "ã™ã¿ã¾ã›ã‚“" },
        { en: "I'm sorry", ja: "ã”ã‚ã‚“ãªã•ã„" },
        { en: "Good morning", ja: "ãŠã¯ã‚ˆã†" },
        { en: "Good night", ja: "ãŠã‚„ã™ã¿ãªã•ã„" },
        { en: "Nice to meet you", ja: "ã¯ã˜ã‚ã¾ã—ã¦" },
        { en: "How are you?", ja: "ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ" },
        { en: "Please", ja: "ãŠé¡˜ã„ã—ã¾ã™" },
        { en: "my", ja: "ç§ã®" },
        { en: "me", ja: "ç§ã‚’" },
        { en: "mine", ja: "ç§ã®ã‚‚ã®" },
        { en: "yours", ja: "ã‚ãªãŸã®ã‚‚ã®" },
        { en: "his", ja: "å½¼ã®" },
        { en: "she", ja: "å½¼å¥³" },
        { en: "her", ja: "	å½¼å¥³ã®" },
        { en: "hers", ja: "å½¼å¥³ã®ã‚‚ã®" },
        { en: "it", ja: "ãã‚Œ" },
        { en: "its", ja: "ãã‚Œã®" },
        { en: "they", ja: "å½¼ã‚‰ã€ãã‚Œã‚‰" },
        { en: "their", ja: "å½¼ã‚‰ã®ã€ãã‚Œã‚‰ã®" },
        { en: "them", ja: "å½¼ã‚‰ã‚’ã€ãã‚Œã‚‰ã‚’" },
        { en: "theirs", ja: "å½¼ã‚‰ã®ã‚‚ã®ã€ãã‚Œã‚‰ã®ã‚‚ã®" },
        { en: "we", ja: "ç§ãŸã¡" },
        { en: "our", ja: "	ç§ãŸã¡ã®" },
        { en: "us", ja: "ç§ãŸã¡ã‚’" },
        { en: "ours", ja: "ç§ãŸã¡ã®ã‚‚ã®" },
        { en: "what", ja: "ä½•" },
        { en: "what color", ja: "ä½•è‰²" },
        { en: "what sports", ja: "ä½•ã®ã‚¹ãƒãƒ¼ãƒ„" },
        { en: "wahat subject", ja: "ä½•ã®ç§‘ç›®" },
         { en: "what day is it today ?", ja: "ä»Šæ—¥ã¯ä½•æ›œæ—¥ï¼Ÿ" },
          { en: "what's your favorite ~ ? ", ja: "ã‚ãªãŸã®å¥½ããªï½ã¯ãªã‚“ã§ã™ã‹ï¼Ÿ" },
           { en: "where", ja: "ã©ã“" },
            { en: "when", ja: "ã„ã¤" },
             { en: "who", ja: "èª°" },
      { en: "whose", ja: "èª°ã®" },
       { en: "which", ja: "ã©ã¡ã‚‰ã®" },
        { en: "how", ja: "ã©ã†ã‚„ã£ã¦" },
         { en: "How do you get to ~ ?", ja: "ã©ã†ã‚„ã£ã¦ï½ã¸è¡Œãã¾ã™ã‹ï¼Ÿ" },
          { en: "How are you?", ja: "å…ƒæ°—ã§ã™ã‹ï¼Ÿ" },
           { en: "How old", ja: "ä½•æ­³" },
            { en: "How much", ja: "ã„ãã‚‰" },
              { en: "How many ?", ja: "ã„ãã¤" },  
       { en: "How about ~ ?", ja: "ï½ã¯ã©ã†ã§ã™ã‹ï¼Ÿ" },  
         { en: "how tall", ja: "ã©ã®ãã‚‰ã„ã®é«˜ã•" },  
           { en: "how long", ja: "ã©ã®ãã‚‰ã„ã®é•·ã•" },  
             { en: "one o'clock", ja: "1æ™‚" },  
               { en: "two o'clock", ja: "2æ™‚" },  
                 { en: "three o'clock", ja: "3æ™‚" },                   
       { en: "four o'clock", ja: "4æ™‚" },  
         { en: "five o'clock", ja: "5æ™‚" },  
           { en: "six o'clock", ja: "6æ™‚" },  
             { en: "seven o'clock", ja: "7æ™‚" },
               { en: "eight o'clock", ja: "8æ™‚" },
        { en: "nine o'clock", ja: "9æ™‚" },
          { en: "ten o'clock", ja: "10æ™‚" },
            { en: "eleven o'clock", ja: "11æ™‚" },
              { en: "twelve o'clock", ja: "12æ™‚" },
                { en: "minute", ja: "åˆ†" },
       { en: "hour", ja: "æ™‚é–“" },
         { en: "day", ja: "æ—¥" },
           { en: "week", ja: "é€±" },
             { en: "month", ja: "æœˆ" },
               { en: "year", ja: "å¹´" },
                 { en: "today", ja: "ä»Šæ—¥" },
       { en: "weekend", ja: "é€±æœ«" },
         { en: "morning", ja: "æœ/åˆå‰ä¸­" },
           { en: "afternoon", ja: "åˆå¾Œ" },
             { en: "evening", ja: "æ™©" },
               { en: "night", ja: "å¤œ" },
       { en: "midnight", ja: "æ·±å¤œ" },
         { en: "birthday", ja: "èª•ç”Ÿæ—¥" },
           { en: "Monday", ja: "æœˆæ›œæ—¥" },
             { en: "Tuesday", ja: "ç«æ›œæ—¥" },
               { en: "Wednesday", ja: "æ°´æ›œæ—¥" },
       { en: "Thursday", ja: "æœ¨æ›œæ—¥" },
         { en: "Friday", ja: "é‡‘æ›œæ—¥" },
           { en: "Saturday", ja: "åœŸæ›œæ—¥" },
             { en: "Sunday", ja: "æ—¥æ›œæ—¥" },
               { en: "January", ja: "1æœˆ" },
                 { en: "February", ja: "2æœˆ" },
       { en: "March", ja: "3æœˆ" },
         { en: "April", ja: "4æœˆ" },
           { en: "May", ja: "5æœˆ" },
             { en: "June", ja: "6æœˆ" },
               { en: "July", ja: "7æœˆ" },
                 { en: "August", ja: "8æœˆ" },
        { en: "September", ja: "9æœˆ" },
          { en: "October", ja: "10æœˆ" },
            { en: "November", ja: "11æœˆ" },
              { en: "December", ja: "12æœˆ" },
     { en: "spring", ja: "æ˜¥" },   
     { en: "summer", ja: "å¤" },   
     { en: "automn", ja: "ç§‹" },   
     { en: "fall", ja: "ç§‹" },   
     { en: "winter", ja: "å†¬" },   
     { en: "Japan", ja: "æ—¥æœ¬" },   
     { en: "America", ja: "ã‚¢ãƒ¡ãƒªã‚«" },   
     { en: "Canada", ja: "ã‚«ãƒŠãƒ€" },   
     { en: "Australia", ja: "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢" },   
     { en: "Spain", ja: "ã‚¹ãƒšã‚¤ãƒ³" },   
     { en: "China", ja: "ä¸­å›½" },   
     { en: "France", ja: "ãƒ•ãƒ©ãƒ³ã‚¹" },   
     { en: "Germany", ja: "ãƒ‰ã‚¤ãƒ„" },   
     { en: "Brazil", ja: "ãƒ–ãƒ©ã‚¸ãƒ«" },   
     { en: "country", ja: "å›½" },   
     { en: "Africa", ja: "ã‚¢ãƒ•ãƒªã‚«" },   
     { en: "Asia", ja: "ã‚¢ã‚¸ã‚¢" },   
     { en: "Europe", ja: "ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘" },   
     { en: "place", ja: "å ´æ‰€" },   
     { en: "station", ja: "é§…" },   
     { en: "airport", ja: "ç©ºæ¸¯" },   
     { en: "park", ja: "å…¬åœ’" },   
     { en: "cityhall", ja: "å¸‚å½¹æ‰€" },   
     { en: "hospital", ja: "ç—…é™¢" },   
     { en: "post office", ja: "éƒµä¾¿å±€" },   
     { en: "store", ja: "åº—" },   
     { en: "supermarket", ja: "ã‚¹ãƒ¼ãƒ‘ãƒ¼" },   
     { en: "mountain", ja: "å±±" },   
     { en: "sea", ja: "æµ·" },   
     { en: "restaurant", ja: "ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³" },   
     { en: "home", ja: "å®¶/æ•…éƒ·" },   
     { en: "house", ja: "ä¸€è»’å®¶" },   
     { en: "room", ja: "éƒ¨å±‹" },   
     { en: "bedroom", ja: "å¯å®¤" },   
     { en: "kitchen", ja: "å°æ‰€" },   
     { en: "bathroom", ja: "ï¼ˆãƒˆã‚¤ãƒ¬ã¤ãã®ï¼‰ãŠé¢¨å‘‚" },   
     { en: "classroom", ja: "æ•™å®¤" },   
     { en: "gym", ja: "ä½“è‚²é¤¨" },   
     { en: "sunny", ja: "æ™´ã‚Œã¦ã„ã‚‹" }, 
     { en: "cloudy", ja: "æ›‡ã£ã¦ã„ã‚‹" }, 
     { en: "rainy", ja: "é›¨ãŒé™ã£ã¦ã„ã‚‹" }, 
     { en: "snowy", ja: "é›ªãŒé™ã£ã¦ã„ã‚‹" }, 
     { en: "foggy", ja: "éœ§ãŒã‹ã£ã¦ã„ã‚‹" }, 
     { en: "windy", ja: "é¢¨ãŒå¼·ã„" }, 
     { en: "sunshine", ja: "æ™´å¤©" }, 
     { en: "cloud", ja: "é›²" }, 
     { en: "rain", ja: "é›¨/é›¨ãŒé™ã‚‹" }, 
     { en: "shower", ja: "é›¨/ã«ã‚ã‹é›¨" }, 
     { en: "snow", ja: "é›ª/é›ªãŒé™ã‚‹" }, 
     { en: "fog", ja: "éœ§" }, 
     { en: "clearup", ja: "æ™´ã‚Œã‚‹" }, 
     { en: "boy", ja: "ç”·ã®å­" }, 
     { en: "children", ja: "å­ã©ã‚‚ãŸã¡" }, 
     { en: "dancer", ja: "ãŠã©ã‚‹äºº" }, 
      { en: "driver", ja: "é‹è»¢æ‰‹" }, 
     { en: "doctor", ja: "åŒ»è€…/åšå£«" }, 
     { en: "friend", ja: "å‹ã ã¡" }, 
     { en: "girl", ja: "å¥³ã®å­" }, 
     { en: "job", ja: "ä»•äº‹" }, 
     { en: "man", ja: "ç”·æ€§" }, 
     { en: "officer", ja: "è­¦å®˜/å½¹äºº" }, 
     { en: "parent", ja: "è¦ª" }, 
     { en: "brother", ja: "å…„å¼Ÿ" }, 
     { en: "sister", ja: "å§‰å¦¹" }, 
     { en: "grandfather", ja: "ãŠã˜ã„ã•ã‚“" }, 
     { en: "grandmother", ja: "	ãŠã°ã‚ã•ã‚“" }, 
     { en: "cousin", ja: "ã„ã¨ã“" }, 
     { en: "person", ja: "äºº" },
      { en: "people", ja: "äººã€…" }, 
     { en: "woman", ja: "å¥³æ€§" }, 
     { en: "worker", ja: "åƒãäºº" }, 
     { en: "basketball", ja: "ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«" }, 
     { en: "badminton", ja: "ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³" }, 
     { en: "tabletennis", ja: "å“çƒ" }, 
     { en: "swimming", ja: "æ°´æ³³" }, 
     { en: "marathon", ja: "ãƒãƒ©ã‚½ãƒ³" }, 
     { en: "dinner", ja: "å¤•é£Ÿ" }, 
     { en: "month", ja: "æœˆ" }, 
     { en: "color", ja: "è‰²" }, 
     { en: "family", ja: "å®¶æ—" }, 
     { en: "flower", ja: "èŠ±" }, 
     { en: "fruit", ja: "æœç‰©" },  
     { en: "drink", ja: "é£²ã¿ç‰©" },  
        { en: "name", ja: "åå‰" },  
        { en: "dictionary", ja: "è¾æ›¸" },  
        { en: "passport", ja: "ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ" },  
            { en: "homework", ja: "å®¿é¡Œ" },  
            { en: "food", ja: "é£Ÿã¹ç‰©" },  
    { en: "animal", ja: "å‹•ç‰©" },
    { en: "box", ja: "ç®±" },   
    { en: "watch", ja: "è…•æ™‚è¨ˆ" },
    { en: "blackboard", ja: "é»’æ¿" },
    { en: "tea", ja: "ãŠèŒ¶" },
    { en: "calendar", ja: "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼" },
    { en: "shoes", ja: "é´" },
    { en: "umbrella", ja: "ã‹ã•" },
     { en: "newspaper", ja: "æ–°è" },
    { en: "window", ja: "çª“" },
    { en: "hair", ja: "é«ª" },
    { en: "diary", ja: "æ—¥è¨˜" },
     { en: "letter", ja: "æ‰‹ç´™" },
    { en: "wall", ja: "å£" },
    { en: "bird", ja: "é³¥" },
    { en: "doll", ja: "äººå½¢" },
     { en: "grape", ja: "ã¶ã©ã†" },
    { en: "camera", ja: "ã‚«ãƒ¡ãƒ©" },
    { en: "mouth", ja: "å£" },
    { en: "coin", ja: "ç¡¬è²¨" },
     { en: "song", ja: "æ›²" },
    { en: "music", ja: "éŸ³æ¥½" },
    { en: "garden", ja: "åº­" },
    { en: "idea", ja: "è€ƒãˆ/æ„è¦‹" },
     { en: "art", ja: "èŠ¸è¡“" },
    { en: "number", ja: "æ•°/ç•ªå·" },
    { en: "history", ja: "æ­´å²" },
    { en: "story", ja: "ç‰©èª/è©±" },
     { en: "subject", ja: "	ç§‘ç›®" },
    { en: "plane", ja: "é£›è¡Œæ©Ÿ" },
    { en: "bread", ja: "ãƒ‘ãƒ³" },
    { en: "dish", ja: "çš¿" },
     { en: "tree", ja: "æœ¨" },
    { en: "fish", ja: "é­š" },
    { en: "like", ja: "ï½ãŒå¥½ã" },
    { en: "have", ja: "ï½ã‚’æŒã£ã¦ã„ã‚‹" },
     { en: "play", ja: "ï¼ˆæ¥½å™¨ã‚’ï¼‰æ¼”å¥ã™ã‚‹ï¼ˆã‚²ãƒ¼ãƒ ã‚’ï¼‰ãƒ—ãƒ¬ã‚¤ã™ã‚‹" },
    { en: "watch", ja: "ï¼ˆãƒ†ãƒ¬ãƒ“ãªã©ï¼‰è¦‹ã‚‹" },
    { en: "want", ja: "ï½ãŒæ¬²ã—ã„" },
    { en: "eat", ja: "ï½ã‚’é£Ÿã¹ã‚‹" },
     { en: "read", ja: "ï½ã‚’èª­ã‚€" },
    { en: "see", ja: "ï½ã‚’è¦‹ã‚‹" },
    { en: "make", ja: "ï½ã‚’ã¤ãã‚‹" },
    { en: "come", ja: "æ¥ã‚‹" },
     { en: "study", ja: "å‹‰å¼·ã™ã‚‹" },
    { en: "get", ja: "ï½ã‚’æŒã¤/æ‰‹ã«å…¥ã‚Œã‚‹" },
    { en: "take", ja: "ï½ã‚’ã¨ã‚‹" },
    { en: "write", ja: "ï½ã‚’æ›¸ã" },
     { en: "work", ja: "åƒã" },
    { en: "use", ja: "ï½ã‚’ä½¿ã†" },
    { en: "drink", ja: "ï½ã‚’é£²ã‚€" },
    { en: "wash", ja: "ï½ã‚’æ´—ã†" },
     { en: "cook", ja: "ï½ã‚’æ–™ç†ã™ã‚‹" },
    { en: "speak	", ja: "ï½ã‚’è©±ã™" },
    { en: "run", ja: "èµ°ã‚‹" },
    { en: "sleep", ja: "å¯ã‚‹" },
     { en: "buy", ja: "ï½ã‚’è²·ã†" },
    { en: "open", ja: "ï½ã‚’é–‹ã‘ã‚‹ãƒ»é–‹ã" },
    { en: "swim", ja: "æ³³ã" },
     { en: "listen", ja: "è´ã" },
    { en: "look", ja: "è¦‹ã‚‹" },
    { en: "sing", ja: "æ­Œã†" },
     { en: "know", ja: "ï½ã‚’çŸ¥ã‚‹" },
    { en: "sit", ja: "åº§ã‚‹" },
    { en: "clean", ja: "ï½ã‚’æƒé™¤ã™ã‚‹" },
     { en: "help", ja: "åŠ©ã‘ã‚‹" },
    { en: "meet", ja: "ï½ã«ä¼šã†" },
    { en: "walk", ja: "æ­©ã" },
     { en: "ski", ja: "ã‚¹ã‚­ãƒ¼ã‚’ã™ã‚‹" },
    { en: "start", ja: "å§‹ã‚ã‚‹" },
    { en: "talk", ja: "è©±ã™" },
     { en: "teach", ja: "æ•™ãˆã‚‹" },
    { en: "think", ja: "è€ƒãˆã‚‹" },
    { en: "need", ja: "ï½ãŒæ¬²ã—ã„" },
     { en: "close", ja: "ï½ã‚’é–‰ã‚ã‚‹" },
    { en: "give", ja: "ï½ã‚’ã‚ã’ã‚‹ãƒ»ä¸ãˆã‚‹" },
    { en: "stop", ja: "æ­¢ã¾ã‚‹" },
     { en: "dance", ja: "ãƒ€ãƒ³ã‚¹ã™ã‚‹" },
    { en: "love", ja: "æ„›ã™ã‚‹" },
    { en: "live", ja: "ç”Ÿãã‚‹/ä½ã‚€" },
     { en: "stand", ja: "ç«‹ã¤" },
    { en: "wait", ja: "å¾…ã¤" },
    { en: "put", ja: "ï½ã‚’ç½®ã" },
     { en: "brush", ja: "ãƒ–ãƒ©ã‚·ã‚’ã‹ã‘ã‚‹" },
    { en: "ride", ja: "ä¹—ã‚‹" },
    { en: "camp", ja: "ã‚­ãƒ£ãƒ³ãƒ—ã‚’ã™ã‚‹" },
     { en: "learn", ja: "ï½ã‚’ç¿’ã†/å­¦ã¶" },
    { en: "smile	", ja: "ç¬‘ã†" },
    { en: "begin", ja: "å§‹ã‚ã‚‹" },
     { en: "enjoy", ja: "ï½ã‚’æ¥½ã—ã‚€" },
    { en: "practice", ja: "ç·´ç¿’ã™ã‚‹" },
    { en: "drive", ja: "ï½ã‚’é‹è»¢ã™ã‚‹" },
     { en: "ask", ja: "ãŠé¡˜ã„ã™ã‚‹" },
    { en: "tell", ja: "ï½ã‚’è¨€ã†" },
    { en: "fly", ja: "é£›ã¶" },
     { en: "jump", ja: "ã‚¸ãƒ£ãƒ³ãƒ—ã™ã‚‹" },
    { en: "stay", ja: "ã¨ã©ã¾ã‚‹" },
    { en: "move", ja: "å‹•ã" },
     { en: "turn", ja: "å›ã‚‹" },
    { en: "visit", ja: "ï½ã‚’è¨ªã­ã‚‹" },
    { en: "try", ja: "ï½ã‚’ã‚„ã£ã¦ã¿ã‚‹" },
    ];

    let currentActiveList = [], currentIndex = 0, score = 0, isChecking = false;
    let currentMode = 'choice', isTimeTrial = false, timerInterval = null, timeLeft = 600;

    function shuffle(array) {
        let arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function changeMode(mode) {
        currentMode = mode;
        const opts = document.querySelectorAll('.mode-option');
        opts[0].classList.toggle('active', mode === 'choice');
        opts[1].classList.toggle('active', mode === 'spell');
        opts[2].classList.toggle('active', mode === 'listen');
        updateHighScoreDisplay();
        resetProgress();
    }

    function toggleTimeTrial() {
        isTimeTrial = !isTimeTrial;
        document.getElementById('timer').style.visibility = isTimeTrial ? 'visible' : 'hidden';
        document.getElementById('time-tri-btn').classList.toggle('active');
        if(isTimeTrial) startTimer(); else stopTimer();
        resetProgress();
    }

    function startTimer() { stopTimer(); timeLeft = 600; updateTimerText(); timerInterval = setInterval(() => { timeLeft--; updateTimerText(); if(timeLeft <= 0) { stopTimer(); finish("ã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼"); } }, 1000); }
    function stopTimer() { clearInterval(timerInterval); }
    function updateTimerText() { const m = Math.floor(timeLeft / 60); const s = timeLeft % 60; document.getElementById('timer').textContent = `${m}:${s.toString().padStart(2, '0')}`; }
    function updateHighScoreDisplay() { document.getElementById('high-score').textContent = localStorage.getItem(`hs_${currentMode}_${isTimeTrial}`) || 0; }

    function resetProgress() {
        currentActiveList = shuffle(masterWordList);
        currentIndex = 0; score = 0;
        document.getElementById('score').textContent = "0";
        showQuestion();
    }

    function showQuestion() {
        if (!masterWordList || masterWordList.length === 0) return;
        if (currentIndex >= currentActiveList.length) {
            if(isTimeTrial) { currentActiveList = shuffle(masterWordList); currentIndex = 0; }
            else { finish("å…¨å•çµ‚äº†ï¼"); return; }
        }
        isChecking = false;
        const q = currentActiveList[currentIndex];
        document.getElementById('feedback').textContent = "";
        const display = document.getElementById('target-display');
        const inputArea = document.getElementById('spell-input-area');
        const optionsArea = document.getElementById('options');
        const speaker = document.getElementById('speaker-icon');

        if (currentMode === 'spell') {
            display.textContent = q.ja; speaker.style.display = 'none'; inputArea.style.display = 'block'; optionsArea.style.display = 'none';
            const input = document.getElementById('spell-input'); input.value = ""; input.disabled = false; input.focus();
        } else if (currentMode === 'listen') {
            display.textContent = "???"; speaker.style.display = 'flex'; inputArea.style.display = 'none'; optionsArea.style.display = 'grid';
            speak(q.en); setupOptions(q);
        } else {
            display.textContent = q.en; speaker.style.display = 'flex'; inputArea.style.display = 'none'; optionsArea.style.display = 'grid';
            speak(q.en); setupOptions(q);
        }
    }

    function setupOptions(q) {
        const others = masterWordList.filter(w => w.ja !== q.ja);
        const opts = shuffle([q.ja, ...shuffle(others).slice(0, 3).map(w => w.ja)]);
        const container = document.getElementById('options');
        container.innerHTML = '';
        opts.forEach(o => {
            const btn = document.createElement('button');
            btn.className = 'option-btn'; btn.textContent = o;
            btn.onclick = () => check(o === q.ja, btn);
            container.appendChild(btn);
        });
    }

    function check(isCorrect, targetElement = null) {
        if(isChecking) return;
        isChecking = true;
        const q = currentActiveList[currentIndex];
        if (currentMode === 'listen') document.getElementById('target-display').textContent = q.en;
        if(isCorrect) {
            if(targetElement) targetElement.classList.add('correct');
            score++; document.getElementById('score').textContent = score;
        } else {
            if(targetElement) targetElement.classList.add('wrong');
            document.getElementById('feedback').innerHTML = `æ­£è§£: ${q.en}`;
        }
        speak(q.en);
        setTimeout(() => { currentIndex++; showQuestion(); }, isCorrect ? 800 : 2500);
    }

    function speak(text) {
        if (!('speechSynthesis' in window)) return;
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'en-US'; u.rate = 0.85;
        speechSynthesis.speak(u);
    }

    function retrySpeak() { if (currentActiveList[currentIndex]) speak(currentActiveList[currentIndex].en); }

    document.getElementById('spell-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') check(document.getElementById('spell-input').value.trim().toLowerCase() === currentActiveList[currentIndex].en.toLowerCase());
    });

    function finish(msg) {
        stopTimer();
        const key = `hs_${currentMode}_${isTimeTrial}`;
        const oldHS = parseInt(localStorage.getItem(key) || 0);
        if(score > oldHS) localStorage.setItem(key, score);
        document.getElementById('game-card').innerHTML = `<h2>${msg}</h2><p style="font-size:1.8rem; color:var(--primary); font-weight:bold;">ã‚¹ã‚³ã‚¢: ${score}</p><p>æœ€é«˜è¨˜éŒ²: ${Math.max(score, oldHS)}</p><button onclick="location.reload()" class="btn-main">ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦</button>`;
    }

    // â˜…ä¿®æ­£ï¼šã¨ã«ã‹ãã™ãã«å‹•ã‹ã™
    (function init() {
        updateHighScoreDisplay();
        resetProgress();
    })();
</script>
</body>
</html>