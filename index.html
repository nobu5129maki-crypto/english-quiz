<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ÂçòË™û„Éû„Çπ„Çø„Éº Pro („É©„É≥„ÉÄ„É†Âá∫È°åÁâà)</title>
    <style>
        :root { --primary: #4CAF50; --bg: #eef2f3; --review: #f39c12; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #effect-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .card { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; position: relative; z-index: 20; }
        .header-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .mode-switch { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; font-weight: bold; }
        .review-trigger { background: var(--review); color: white; border: none; border-radius: 12px; padding: 5px 12px; font-size: 0.8rem; cursor: pointer; display: none; font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .switch { position: relative; display: inline-block; width: 44px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }
        .word-display { font-size: 2.5rem; font-weight: bold; margin-bottom: 1.5rem; color: #2c3e50; }
        .options-grid { display: grid; gap: 10px; }
        .option-btn { padding: 15px; border: 2px solid #ddd; border-radius: 12px; background: white; cursor: pointer; font-size: 1.1rem; transition: 0.2s; }
        .option-btn.correct { background: #d4edda; border-color: #28a745; }
        .option-btn.wrong { background: #f8d7da; border-color: #dc3545; }
        #spell-input-area { display: none; margin-top: 10px; }
        #spell-input { width: 85%; padding: 12px; font-size: 1.2rem; border: 2px solid #ddd; border-radius: 10px; text-align: center; margin-bottom: 10px; }
        #spell-input:disabled { background: #f9f9f9; }
        .hint-btn { background: none; border: 1px solid #aaa; color: #777; padding: 5px 15px; border-radius: 15px; cursor: pointer; font-size: 0.8rem; }
        #hint-display { margin-top: 10px; font-family: monospace; font-size: 1.2rem; color: #555; letter-spacing: 3px; min-height: 1.5rem; }
        .speaker-btn { background: #eee; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.2rem; }
        .btn-main { padding: 12px 25px; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 8px; width: 100%; margin-top: 10px; }
        #feedback { margin-top: 20px; font-weight: bold; min-height: 30px; font-size: 1.1rem; }
    </style>
</head>
<body>
<canvas id="effect-canvas"></canvas>
<div class="card" id="game-card">
    <div class="header-controls">
        <div class="mode-switch">
            <span>4Êäû</span>
            <label class="switch"><input type="checkbox" id="mode-toggle" onchange="resetProgress()"><span class="slider"></span></label>
            <span>Êõ∏„Åè</span>
        </div>
        <button id="review-btn" class="review-trigger" onclick="startReviewMode()">‚ö° Âæ©Áøí (<span id="wrong-count">0</span>)</button>
    </div>
    <div class="score-board" style="color:#7f8c8d; margin-bottom:10px; font-size: 0.9rem;">
        <span id="list-label" style="font-weight:bold;">ÂïèÈ°å</span>: <span id="current">1</span>/<span id="total">0</span> | „Çπ„Ç≥„Ç¢: <span id="score">0</span>
    </div>
    <div class="word-display"><span id="target-display">---</span> <button id="speaker-icon" class="speaker-btn" onclick="retrySpeak()" style="display:none;">üîä</button></div>
    <div class="options-grid" id="options"></div>
    <div id="spell-input-area"><input type="text" id="spell-input" placeholder="„Åì„Åì„Å´ÂÖ•Âäõ..." autocomplete="off"><br><button class="hint-btn" onclick="showHint()">üí° „Éí„É≥„Éà</button><div id="hint-display"></div></div>
    <div id="feedback"></div>
</div>

<script>
    const masterWordList = [
             { en: "Hello", ja: "„Åì„Çì„Å´„Å°„ÅØ" },
        { en: "Thank you", ja: "„ÅÇ„Çä„Åå„Å®„ÅÜ" },
        { en: "Excuse me", ja: "„Åô„Åø„Åæ„Åõ„Çì" },
        { en: "I'm sorry", ja: "„Åî„ÇÅ„Çì„Å™„Åï„ÅÑ" },
        { en: "Good morning", ja: "„Åä„ÅØ„Çà„ÅÜ" },
        { en: "Good night", ja: "„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ" },
        { en: "Nice to meet you", ja: "„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶" },
        { en: "How are you?", ja: "„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü" },
        { en: "Please", ja: "„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô" },
        { en: "my", ja: "ÁßÅ„ÅÆ" },
        { en: "me", ja: "ÁßÅ„Çí" },
        { en: "mine", ja: "ÁßÅ„ÅÆ„ÇÇ„ÅÆ" },
        { en: "yours", ja: "„ÅÇ„Å™„Åü„ÅÆ„ÇÇ„ÅÆ" },
        { en: "his", ja: "ÂΩº„ÅÆ" },
        { en: "she", ja: "ÂΩºÂ•≥" },
        { en: "her", ja: "	ÂΩºÂ•≥„ÅÆ" },
        { en: "hers", ja: "ÂΩºÂ•≥„ÅÆ„ÇÇ„ÅÆ" },
        { en: "it", ja: "„Åù„Çå" },
        { en: "its", ja: "„Åù„Çå„ÅÆ" },
        { en: "they", ja: "ÂΩº„Çâ„ÄÅ„Åù„Çå„Çâ" },
        { en: "their", ja: "ÂΩº„Çâ„ÅÆ„ÄÅ„Åù„Çå„Çâ„ÅÆ" },
        { en: "them", ja: "ÂΩº„Çâ„Çí„ÄÅ„Åù„Çå„Çâ„Çí" },
        { en: "theirs", ja: "ÂΩº„Çâ„ÅÆ„ÇÇ„ÅÆ„ÄÅ„Åù„Çå„Çâ„ÅÆ„ÇÇ„ÅÆ" },
        { en: "we", ja: "ÁßÅ„Åü„Å°" },
        { en: "our", ja: "	ÁßÅ„Åü„Å°„ÅÆ" },
        { en: "us", ja: "ÁßÅ„Åü„Å°„Çí" },
        { en: "ours", ja: "ÁßÅ„Åü„Å°„ÅÆ„ÇÇ„ÅÆ" },
        { en: "what", ja: "‰Ωï" },
        { en: "what color", ja: "‰ΩïËâ≤" },
        { en: "what sports", ja: "‰Ωï„ÅÆ„Çπ„Éù„Éº„ÉÑ" },
        { en: "wahat subject", ja: "‰Ωï„ÅÆÁßëÁõÆ" },
         { en: "what day is it today ?", ja: "‰ªäÊó•„ÅØ‰ΩïÊõúÊó•Ôºü" },
          { en: "what's your favorite ~ ? ", ja: "„ÅÇ„Å™„Åü„ÅÆÂ•Ω„Åç„Å™ÔΩû„ÅØ„Å™„Çì„Åß„Åô„ÅãÔºü" },
           { en: "where", ja: "„Å©„Åì" },
            { en: "when", ja: "„ÅÑ„Å§" },
             { en: "who", ja: "Ë™∞" },
      { en: "whose", ja: "Ë™∞„ÅÆ" },
       { en: "which", ja: "„Å©„Å°„Çâ„ÅÆ" },
        { en: "how", ja: "„Å©„ÅÜ„ÇÑ„Å£„Å¶" },
         { en: "How do you get to ~ ?", ja: "„Å©„ÅÜ„ÇÑ„Å£„Å¶ÔΩû„Å∏Ë°å„Åç„Åæ„Åô„ÅãÔºü" },
          { en: "How are you?", ja: "ÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü" },
           { en: "How old", ja: "‰ΩïÊ≠≥" },
            { en: "How much", ja: "„ÅÑ„Åè„Çâ" },
              { en: "How many ?", ja: "„ÅÑ„Åè„Å§" },  
       { en: "How about ~ ?", ja: "ÔΩû„ÅØ„Å©„ÅÜ„Åß„Åô„ÅãÔºü" },  
         { en: "how tall", ja: "„Å©„ÅÆ„Åè„Çâ„ÅÑ„ÅÆÈ´ò„Åï" },  
           { en: "how long", ja: "„Å©„ÅÆ„Åè„Çâ„ÅÑ„ÅÆÈï∑„Åï" },  
             { en: "one o'clock", ja: "1ÊôÇ" },  
               { en: "two o'clock", ja: "2ÊôÇ" },  
                 { en: "three o'clock", ja: "3ÊôÇ" },                   
       { en: "four o'clock", ja: "4ÊôÇ" },  
         { en: "five o'clock", ja: "5ÊôÇ" },  
           { en: "six o'clock", ja: "6ÊôÇ" },  
             { en: "seven o'clock", ja: "7ÊôÇ" },
               { en: "eight o'clock", ja: "8ÊôÇ" },
        { en: "nine o'clock", ja: "9ÊôÇ" },
          { en: "ten o'clock", ja: "10ÊôÇ" },
            { en: "eleven o'clock", ja: "11ÊôÇ" },
              { en: "twelve o'clock", ja: "12ÊôÇ" },
                { en: "minute", ja: "ÂàÜ" },
       { en: "hour", ja: "ÊôÇÈñì" },
         { en: "day", ja: "Êó•" },
           { en: "week", ja: "ÈÄ±" },
             { en: "month", ja: "Êúà" },
               { en: "year", ja: "Âπ¥" },
                 { en: "today", ja: "‰ªäÊó•" },
       { en: "weekend", ja: "ÈÄ±Êú´" },
         { en: "morning", ja: "Êúù/ÂçàÂâç‰∏≠" },
           { en: "afternoon", ja: "ÂçàÂæå" },
             { en: "evening", ja: "Êô©" },
               { en: "night", ja: "Â§ú" },
       { en: "midnight", ja: "Ê∑±Â§ú" },
         { en: "birthday", ja: "Ë™ïÁîüÊó•" },
           { en: "Monday", ja: "ÊúàÊõúÊó•" },
             { en: "Tuesday", ja: "ÁÅ´ÊõúÊó•" },
               { en: "Wednesday", ja: "Ê∞¥ÊõúÊó•" },
       { en: "Thursday", ja: "Êú®ÊõúÊó•" },
         { en: "Friday", ja: "ÈáëÊõúÊó•" },
           { en: "Saturday", ja: "ÂúüÊõúÊó•" },
             { en: "Sunday", ja: "Êó•ÊõúÊó•" },
               { en: "January", ja: "1Êúà" },
                 { en: "February", ja: "2Êúà" },
       { en: "March", ja: "3Êúà" },
         { en: "April", ja: "4Êúà" },
           { en: "May", ja: "5Êúà" },
             { en: "June", ja: "6Êúà" },
               { en: "July", ja: "7Êúà" },
                 { en: "August", ja: "8Êúà" },
        { en: "September", ja: "9Êúà" },
          { en: "October", ja: "10Êúà" },
            { en: "November", ja: "11Êúà" },
              { en: "December", ja: "12Êúà" },
     { en: "spring", ja: "Êò•" },   
     { en: "summer", ja: "Â§è" },   
     { en: "automn", ja: "Áßã" },   
     { en: "fall", ja: "Áßã" },   
     { en: "winter", ja: "ÂÜ¨" },   
     { en: "Japan", ja: "Êó•Êú¨" },   
     { en: "America", ja: "„Ç¢„É°„É™„Ç´" },   
     { en: "Canada", ja: "„Ç´„Éä„ÉÄ" },   
     { en: "Australia", ja: "„Ç™„Éº„Çπ„Éà„É©„É™„Ç¢" },   
     { en: "Spain", ja: "„Çπ„Éö„Ç§„É≥" },   
     { en: "China", ja: "‰∏≠ÂõΩ" },   
     { en: "France", ja: "„Éï„É©„É≥„Çπ" },   
     { en: "Germany", ja: "„Éâ„Ç§„ÉÑ" },   
     { en: "Brazil", ja: "„Éñ„É©„Ç∏„É´" },   
     { en: "country", ja: "ÂõΩ" },   
     { en: "Africa", ja: "„Ç¢„Éï„É™„Ç´" },   
     { en: "Asia", ja: "„Ç¢„Ç∏„Ç¢" },   
     { en: "Europe", ja: "„É®„Éº„É≠„ÉÉ„Éë" },   
     { en: "place", ja: "Â†¥ÊâÄ" },   
     { en: "station", ja: "ÈßÖ" },   
     { en: "airport", ja: "Á©∫Ê∏Ø" },   
     { en: "park", ja: "ÂÖ¨Âúí" },   
     { en: "cityhall", ja: "Â∏ÇÂΩπÊâÄ" },   
     { en: "hospital", ja: "ÁóÖÈô¢" },   
     { en: "post office", ja: "ÈÉµ‰æøÂ±Ä" },   
     { en: "store", ja: "Â∫ó" },   
     { en: "supermarket", ja: "„Çπ„Éº„Éë„Éº" },   
     { en: "mountain", ja: "Â±±" },   
     { en: "sea", ja: "Êµ∑" },   
     { en: "restaurant", ja: "„É¨„Çπ„Éà„É©„É≥" },   
     { en: "home", ja: "ÂÆ∂/ÊïÖÈÉ∑" },   
     { en: "house", ja: "‰∏ÄËªíÂÆ∂" },   
     { en: "room", ja: "ÈÉ®Â±ã" },   
     { en: "bedroom", ja: "ÂØùÂÆ§" },   
     { en: "kitchen", ja: "Âè∞ÊâÄ" },   
     { en: "bathroom", ja: "Ôºà„Éà„Ç§„É¨„Å§„Åç„ÅÆÔºâ„ÅäÈ¢®ÂëÇ" },   
     { en: "classroom", ja: "ÊïôÂÆ§" },   
     { en: "gym", ja: "‰ΩìËÇ≤È§®" },   
     { en: "sunny", ja: "Êô¥„Çå„Å¶„ÅÑ„Çã" }, 
     { en: "cloudy", ja: "Êõá„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "rainy", ja: "Èõ®„ÅåÈôç„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "snowy", ja: "Èõ™„ÅåÈôç„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "foggy", ja: "Èúß„Åå„Åã„Å£„Å¶„ÅÑ„Çã" }, 
     { en: "windy", ja: "È¢®„ÅåÂº∑„ÅÑ" }, 
     { en: "sunshine", ja: "Êô¥Â§©" }, 
     { en: "cloud", ja: "Èõ≤" }, 
     { en: "rain", ja: "Èõ®/Èõ®„ÅåÈôç„Çã" }, 
     { en: "shower", ja: "Èõ®/„Å´„Çè„ÅãÈõ®" }, 
     { en: "snow", ja: "Èõ™/Èõ™„ÅåÈôç„Çã" }, 
     { en: "fog", ja: "Èúß" }, 
     { en: "clearup", ja: "Êô¥„Çå„Çã" }, 
     { en: "boy", ja: "Áî∑„ÅÆÂ≠ê" }, 
     { en: "children", ja: "Â≠ê„Å©„ÇÇ„Åü„Å°" }, 
     { en: "dancer", ja: "„Åä„Å©„Çã‰∫∫" }, 
      { en: "driver", ja: "ÈÅãËª¢Êâã" }, 
     { en: "doctor", ja: "ÂåªËÄÖ/ÂçöÂ£´" }, 
     { en: "friend", ja: "Âèã„Å†„Å°" }, 
     { en: "girl", ja: "Â•≥„ÅÆÂ≠ê" }, 
     { en: "job", ja: "‰ªï‰∫ã" }, 
     { en: "man", ja: "Áî∑ÊÄß" }, 
     { en: "officer", ja: "Ë≠¶ÂÆò/ÂΩπ‰∫∫" }, 
     { en: "parent", ja: "Ë¶™" }, 
     { en: "brother", ja: "ÂÖÑÂºü" }, 
     { en: "sister", ja: "ÂßâÂ¶π" }, 
     { en: "grandfather", ja: "„Åä„Åò„ÅÑ„Åï„Çì" }, 
     { en: "grandmother", ja: "	„Åä„Å∞„ÅÇ„Åï„Çì" }, 
     { en: "cousin", ja: "„ÅÑ„Å®„Åì" }, 
     { en: "person", ja: "‰∫∫" },
      { en: "people", ja: "‰∫∫„ÄÖ" }, 
     { en: "woman", ja: "Â•≥ÊÄß" }, 
     { en: "worker", ja: "ÂÉç„Åè‰∫∫" }, 
     { en: "basketball", ja: "„Éê„Çπ„Ç±„ÉÉ„Éà„Éú„Éº„É´" }, 
     { en: "badminton", ja: "„Éê„Éâ„Éü„É≥„Éà„É≥" }, 
     { en: "tabletennis", ja: "ÂçìÁêÉ" }, 
     { en: "swimming", ja: "Ê∞¥Ê≥≥" }, 
     { en: "marathon", ja: "„Éû„É©„ÇΩ„É≥" }, 
     { en: "dinner", ja: "Â§ïÈ£ü" }, 
     { en: "month", ja: "Êúà" }, 
     { en: "color", ja: "Ëâ≤" }, 
     { en: "family", ja: "ÂÆ∂Êóè" }, 
     { en: "flower", ja: "Ëä±" }, 
     { en: "fruit", ja: "ÊûúÁâ©" },  
     { en: "drink", ja: "È£≤„ÅøÁâ©" },  
        { en: "name", ja: "ÂêçÂâç" },  
        { en: "dictionary", ja: "ËæûÊõ∏" },  
        { en: "passport", ja: "„Éë„Çπ„Éù„Éº„Éà" },  
            { en: "homework", ja: "ÂÆøÈ°å" },  
            { en: "food", ja: "È£ü„ÅπÁâ©" },  
    { en: "animal", ja: "ÂãïÁâ©" },
    { en: "box", ja: "ÁÆ±" },   
    { en: "watch", ja: "ËÖïÊôÇË®à" },
    { en: "blackboard", ja: "ÈªíÊùø" },
    { en: "tea", ja: "„ÅäËå∂" },
    { en: "calendar", ja: "„Ç´„É¨„É≥„ÉÄ„Éº" },
    { en: "shoes", ja: "Èù¥" },
    { en: "umbrella", ja: "„Åã„Åï" },
     { en: "newspaper", ja: "Êñ∞ËÅû" },
    { en: "window", ja: "Á™ì" },
    { en: "hair", ja: "È´™" },
    { en: "diary", ja: "Êó•Ë®ò" },
     { en: "letter", ja: "ÊâãÁ¥ô" },
    { en: "wall", ja: "Â£Å" },
    { en: "bird", ja: "È≥•" },
    { en: "doll", ja: "‰∫∫ÂΩ¢" },
     { en: "grape", ja: "„Å∂„Å©„ÅÜ" },
    { en: "camera", ja: "„Ç´„É°„É©" },
    { en: "mouth", ja: "Âè£" },
    { en: "coin", ja: "Á°¨Ë≤®" },
     { en: "song", ja: "Êõ≤" },
    { en: "music", ja: "Èü≥Ê•Ω" },
    { en: "garden", ja: "Â∫≠" },
    { en: "idea", ja: "ËÄÉ„Åà/ÊÑèË¶ã" },
     { en: "art", ja: "Ëä∏Ë°ì" },
    { en: "number", ja: "Êï∞/Áï™Âè∑" },
    { en: "history", ja: "Ê≠¥Âè≤" },
    { en: "story", ja: "Áâ©Ë™û/Ë©±" },
     { en: "subject", ja: "	ÁßëÁõÆ" },
    { en: "plane", ja: "È£õË°åÊ©ü" },
    { en: "bread", ja: "„Éë„É≥" },
    { en: "dish", ja: "Áöø" },
     { en: "tree", ja: "Êú®" },
    { en: "fish", ja: "È≠ö" },
    { en: "like", ja: "ÔΩû„ÅåÂ•Ω„Åç" },
    { en: "have", ja: "ÔΩû„ÇíÊåÅ„Å£„Å¶„ÅÑ„Çã" },
     { en: "play", ja: "ÔºàÊ•ΩÂô®„ÇíÔºâÊºîÂ•è„Åô„ÇãÔºà„Ç≤„Éº„É†„ÇíÔºâ„Éó„É¨„Ç§„Åô„Çã" },
    { en: "watch", ja: "Ôºà„ÉÜ„É¨„Éì„Å™„Å©ÔºâË¶ã„Çã" },
    { en: "want", ja: "ÔΩû„ÅåÊ¨≤„Åó„ÅÑ" },
    { en: "eat", ja: "ÔΩû„ÇíÈ£ü„Åπ„Çã" },
     { en: "read", ja: "ÔΩû„ÇíË™≠„ÇÄ" },
    { en: "see", ja: "ÔΩû„ÇíË¶ã„Çã" },
    { en: "make", ja: "ÔΩû„Çí„Å§„Åè„Çã" },
    { en: "come", ja: "Êù•„Çã" },
     { en: "study", ja: "ÂãâÂº∑„Åô„Çã" },
    { en: "get", ja: "ÔΩû„ÇíÊåÅ„Å§/Êâã„Å´ÂÖ•„Çå„Çã" },
    { en: "take", ja: "ÔΩû„Çí„Å®„Çã" },
    { en: "write", ja: "ÔΩû„ÇíÊõ∏„Åè" },
     { en: "work", ja: "ÂÉç„Åè" },
    { en: "use", ja: "ÔΩû„Çí‰Ωø„ÅÜ" },
    { en: "drink", ja: "ÔΩû„ÇíÈ£≤„ÇÄ" },
    { en: "wash", ja: "ÔΩû„ÇíÊ¥ó„ÅÜ" },
     { en: "cook", ja: "ÔΩû„ÇíÊñôÁêÜ„Åô„Çã" },
    { en: "speak	", ja: "ÔΩû„ÇíË©±„Åô" },
    { en: "run", ja: "Ëµ∞„Çã" },
    { en: "sleep", ja: "ÂØù„Çã" },
     { en: "buy", ja: "ÔΩû„ÇíË≤∑„ÅÜ" },
    { en: "open", ja: "ÔΩû„ÇíÈñã„Åë„Çã„ÉªÈñã„Åè" },
    { en: "swim", ja: "Ê≥≥„Åê" },
     { en: "listen", ja: "ËÅ¥„Åè" },
    { en: "look", ja: "Ë¶ã„Çã" },
    { en: "sing", ja: "Ê≠å„ÅÜ" },
     { en: "know", ja: "ÔΩû„ÇíÁü•„Çã" },
    { en: "sit", ja: "Â∫ß„Çã" },
    { en: "clean", ja: "ÔΩû„ÇíÊéÉÈô§„Åô„Çã" },
     { en: "help", ja: "Âä©„Åë„Çã" },
    { en: "meet", ja: "ÔΩû„Å´‰ºö„ÅÜ" },
    { en: "walk", ja: "Ê≠©„Åè" },
     { en: "ski", ja: "„Çπ„Ç≠„Éº„Çí„Åô„Çã" },
    { en: "start", ja: "Âßã„ÇÅ„Çã" },
    { en: "talk", ja: "Ë©±„Åô" },
     { en: "teach", ja: "Êïô„Åà„Çã" },
    { en: "think", ja: "ËÄÉ„Åà„Çã" },
    { en: "need", ja: "ÔΩû„ÅåÊ¨≤„Åó„ÅÑ" },
     { en: "close", ja: "ÔΩû„ÇíÈñâ„ÇÅ„Çã" },
    { en: "give", ja: "ÔΩû„Çí„ÅÇ„Åí„Çã„Éª‰∏é„Åà„Çã" },
    { en: "stop", ja: "Ê≠¢„Åæ„Çã" },
     { en: "dance", ja: "„ÉÄ„É≥„Çπ„Åô„Çã" },
    { en: "love", ja: "ÊÑõ„Åô„Çã" },
    { en: "live", ja: "Áîü„Åç„Çã/‰Ωè„ÇÄ" },
     { en: "stand", ja: "Á´ã„Å§" },
    { en: "wait", ja: "ÂæÖ„Å§" },
    { en: "put", ja: "ÔΩû„ÇíÁΩÆ„Åè" },
     { en: "brush", ja: "„Éñ„É©„Ç∑„Çí„Åã„Åë„Çã" },
    { en: "ride", ja: "‰πó„Çã" },
    { en: "camp", ja: "„Ç≠„É£„É≥„Éó„Çí„Åô„Çã" },
     { en: "learn", ja: "ÔΩû„ÇíÁøí„ÅÜ/Â≠¶„Å∂" },
    { en: "smile	", ja: "Á¨ë„ÅÜ" },
    { en: "begin", ja: "Âßã„ÇÅ„Çã" },
     { en: "enjoy", ja: "ÔΩû„ÇíÊ•Ω„Åó„ÇÄ" },
    { en: "practice", ja: "Á∑¥Áøí„Åô„Çã" },
    { en: "drive", ja: "ÔΩû„ÇíÈÅãËª¢„Åô„Çã" },
     { en: "ask", ja: "„ÅäÈ°ò„ÅÑ„Åô„Çã" },
    { en: "tell", ja: "ÔΩû„ÇíË®Ä„ÅÜ" },
    { en: "fly", ja: "È£õ„Å∂" },
     { en: "jump", ja: "„Ç∏„É£„É≥„Éó„Åô„Çã" },
    { en: "stay", ja: "„Å®„Å©„Åæ„Çã" },
    { en: "move", ja: "Âãï„Åè" },
     { en: "turn", ja: "Âõû„Çã" },
    { en: "visit", ja: "ÔΩû„ÇíË®™„Å≠„Çã" },
    { en: "try", ja: "ÔΩû„Çí„ÇÑ„Å£„Å¶„Åø„Çã" },
    ];

    let currentActiveList = [];
    let wrongList = [];
    let currentIndex = 0, score = 0, isAnswered = false, nativeVoice = null;

    // --- ‚òÖÊîπËâØ„Éù„Ç§„É≥„Éà1: „Éï„Ç£„ÉÉ„Ç∑„É£„Éº‚Äì„Ç§„Çß„Éº„ÉÑ„ÅÆ„Ç∑„É£„ÉÉ„Éï„É´Èñ¢Êï∞ ---
    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function saveGame() {
        const data = {
            currentIndex, score, 
            isSpellMode: document.getElementById('mode-toggle').checked,
            wrongList,
            currentActiveList, // ÁèæÂú®„ÅÆ„Ç∑„É£„ÉÉ„Éï„É´„Åï„Çå„Åü‰∏¶„Å≥È†Ü„ÇÇ‰øùÂ≠ò
            isReviewMode: (document.getElementById('list-label').textContent === "Âæ©Áøí")
        };
        localStorage.setItem('english_quiz_save_v3', JSON.stringify(data));
        updateReviewButton();
    }

    function loadGame() {
        const saved = localStorage.getItem('english_quiz_save_v3');
        if (saved) {
            const data = JSON.parse(saved);
            currentIndex = data.currentIndex;
            score = data.score;
            wrongList = data.wrongList || [];
            currentActiveList = data.currentActiveList || [];
            document.getElementById('mode-toggle').checked = data.isSpellMode;
            document.getElementById('score').textContent = score;
            if (data.isReviewMode) document.getElementById('list-label').textContent = "Âæ©Áøí";
        } else {
            // ÂàùÂõûËµ∑ÂãïÊôÇ„ÅØ„Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶ÈñãÂßã
            currentActiveList = shuffle([...masterWordList]);
        }
        updateReviewButton();
    }

    function updateReviewButton() {
        const btn = document.getElementById('review-btn');
        const count = document.getElementById('wrong-count');
        if (wrongList.length > 0 && document.getElementById('list-label').textContent !== "Âæ©Áøí") {
            btn.style.display = "block";
            count.textContent = wrongList.length;
        } else {
            btn.style.display = "none";
        }
    }

    function resetProgress() { 
        currentActiveList = shuffle([...masterWordList]); // ‚òÖ„É™„Çª„ÉÉ„ÉàÊôÇ„ÇÇ„É©„É≥„ÉÄ„É†„Å´
        wrongList = []; currentIndex = 0; score = 0; 
        document.getElementById('score').textContent = "0"; 
        document.getElementById('list-label').textContent = "ÂïèÈ°å";
        saveGame(); showQuestion(); 
    }

    function startReviewMode() {
        if (wrongList.length === 0) return;
        currentActiveList = shuffle([...wrongList]); // ‚òÖÂæ©ÁøíÈñãÂßãÊôÇ„ÇÇ„É©„É≥„ÉÄ„É†„Å´
        wrongList = []; currentIndex = 0; score = 0;
        document.getElementById('score').textContent = "0";
        document.getElementById('list-label').textContent = "Âæ©Áøí";
        saveGame(); showQuestion();
    }

    // Canvas/Voice/UI ÊèèÁîª„É≠„Ç∏„ÉÉ„ÇØ„ÅØÂâçÂõûÂêåÊßò
    const canvas = document.getElementById('effect-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize); resize();
    class Particle {
        constructor(x, y, color) {
            this.x = x; this.y = y; this.size = Math.random()*8+4;
            this.speedX = Math.random()*6-3; this.speedY = Math.random()*-10-5;
            this.gravity = 0.3; this.color = color; this.alpha = 1;
        }
        update() { this.speedY += this.gravity; this.x += this.speedX; this.y += this.speedY; this.alpha -= 0.01; }
        draw() { ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.size, this.size); }
    }
    function animate() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        particles = particles.filter(p => p.alpha > 0);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }
    animate();
    function triggerSuccessEffect() {
        const colors = ['#FFC107', '#2196F3', '#4CAF50', '#E91E63'];
        for(let i=0; i<50; i++) particles.push(new Particle(window.innerWidth/2, window.innerHeight/2, colors[Math.floor(Math.random()*colors.length)]));
    }
    function loadVoices() { nativeVoice = speechSynthesis.getVoices().find(v => v.lang.includes('en-US') && (v.name.includes('Google') || v.name.includes('Premium'))); }
    speechSynthesis.onvoiceschanged = loadVoices;
    function speak(text) {
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        if(nativeVoice) u.voice = nativeVoice;
        u.lang = 'en-US'; u.rate = 0.85;
        speechSynthesis.speak(u);
    }

    function showHint() {
        if (isAnswered) return;
        const target = currentActiveList[currentIndex].en;
        let hint = "";
        for (let i = 0; i < target.length; i++) {
            if (i === 0 || i === target.length - 1 || target[i] === " ") hint += target[i];
            else hint += "_";
        }
        document.getElementById('hint-display').textContent = hint;
    }

    function showQuestion() {
        if (currentIndex >= currentActiveList.length) { finish(); return; }
        isAnswered = false;
        const q = currentActiveList[currentIndex];
        const isSpellMode = document.getElementById('mode-toggle').checked;
        document.getElementById('current').textContent = currentIndex + 1;
        document.getElementById('total').textContent = currentActiveList.length;
        document.getElementById('feedback').textContent = "";
        document.getElementById('hint-display').textContent = "";
        const input = document.getElementById('spell-input');
        input.disabled = false;

        if (isSpellMode) {
            document.getElementById('target-display').textContent = q.ja;
            document.getElementById('options').style.display = 'none';
            document.getElementById('spell-input-area').style.display = 'block';
            document.getElementById('speaker-icon').style.display = 'none';
            input.value = ""; input.focus();
        } else {
            document.getElementById('target-display').textContent = q.en;
            document.getElementById('options').style.display = 'grid';
            document.getElementById('spell-input-area').style.display = 'none';
            document.getElementById('speaker-icon').style.display = 'inline-block';
            speak(q.en);
            const opts = [q.ja, ...masterWordList.filter(w=>w.ja!==q.ja).map(w=>w.ja).sort(()=>0.5-Math.random()).slice(0,3)].sort(()=>0.5-Math.random());
            const container = document.getElementById('options');
            container.innerHTML = '';
            opts.forEach(o => {
                const btn = document.createElement('button');
                btn.className = 'option-btn'; btn.textContent = o;
                btn.onclick = () => check(o === q.ja, btn);
                container.appendChild(btn);
            });
        }
        saveGame();
    }

    function check(isCorrect, targetElement = null) {
        if(isAnswered) return;
        isAnswered = true;
        const q = currentActiveList[currentIndex];
        const feedback = document.getElementById('feedback');
        const input = document.getElementById('spell-input');
        input.disabled = true;
        let delay = 1500;
        if(isCorrect) {
            if(targetElement) targetElement.classList.add('correct');
            feedback.innerHTML = `<span style="color:#28a745">Ê≠£Ëß£ÔºÅ ‚ú®</span>`;
            score++; document.getElementById('score').textContent = score;
            triggerSuccessEffect(); speak(q.en);
        } else {
            if(targetElement) targetElement.classList.add('wrong');
            feedback.innerHTML = `<span style="color:#dc3545">Ê≠£Ëß£: <strong>${q.en}</strong></span>`;
            speak(q.en);
            delay = 4000;
            if (!wrongList.some(w => w.en === q.en)) wrongList.push(q);
        }
        setTimeout(() => { currentIndex++; showQuestion(); }, delay);
    }

    document.getElementById('spell-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const val = e.target.value.trim().toLowerCase();
            const correct = currentActiveList[currentIndex].en.toLowerCase();
            check(val === correct);
        }
    });

    function retrySpeak() { speak(currentActiveList[currentIndex].en); }

    function finish() { 
        localStorage.removeItem('english_quiz_save_v3');
        let html = `<h2>ÂÆå‰∫ÜÔºÅ</h2><p style="font-size:1.5rem">„Çπ„Ç≥„Ç¢: ${score}/${currentActiveList.length}</p>`;
        if (wrongList.length > 0) html += `<button onclick="startReviewMode()" class="btn-main" style="background:var(--review)">ÈñìÈÅï„Åà„ÅüÂïèÈ°å„ÇíÂæ©Áøí</button>`;
        html += `<button onclick="location.reload()" class="btn-main">ÂÖ®ÂçòË™û„ÅßÊúÄÂàù„Åã„Çâ</button>`;
        document.getElementById('game-card').innerHTML = html; 
    }

    loadGame();
    showQuestion();
</script>
</body>
</html>